<!DOCTYPE html>
<html class="nojs" lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>magento and rest api – Random thoughts</title>
<meta name="description" content="Magento provides both REST and SOAP api. In this post I would like to concentrate on REST api to connect and get the products from magento shop. First we want to register …">
<meta name="created" content="2013-07-05T00:00:00&#43;0000">
<meta name="modified" content="2013-07-05T00:00:00&#43;0000">

<meta name="contact" content="me@harikt.com">
<meta property="og:site_name" content="Random thoughts">
<meta property="og:title" content="magento and rest api">
<meta property="og:url" content="https://harikt.com/blog/2013/07/05/magento-and-rest-api/">
<meta property="og:type" content="article">
<meta property="og:image" content="https://harikt.com/apple-touch-icon-180.png">
<meta name="generator" content="Hugo 0.60.0" />
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">


<link rel="canonical" href="https://harikt.com/blog/2013/07/05/magento-and-rest-api/">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="stylesheet" href="/css/mobile.2ab74aa64785dcab8114959e76ca140cf76207cd85989bc6d4fc3b12f734a09e.css" media="screen">
<link rel="stylesheet" href="/css/styles.815d832c412376a2dcbec755e26a23c857bfc9df27f5000cebf4428684f1bdb5.css">
<link rel="stylesheet" href="/css/print.27fc184f8670f41a2690985390779e7b20335a8fadff8fa015cf9417ffe50c36.css" media="print">

<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "magento and rest api",
    "datePublished": "2013-07-05T00:00:00Z",
    "dateModified": "2013-07-05T00:00:00Z",
    "url" : "https://harikt.com/blog/2013/07/05/magento-and-rest-api/",
    "description": "Magento provides both REST and SOAP api. In this post I would like to concentrate on REST api to connect and get the products from magento shop. First we want to register …",
    "image" : "https://harikt.com/apple-touch-icon-180.png",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://harikt.com/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Random thoughts",
      "logo" : {
        "@type": "ImageObject",
        "url": "https://harikt.com/apple-touch-icon-180.png"
      },
      "url": "https://harikt.com/"
    }
  }
</script>

<script defer src="/js/jquery.slim.min.a5ab2a00a0439854f8787a0dda775dea5377ef4905886505c938941d6854ee4f.js"></script>
<script defer src="/js/umbrella.min.b426107371d121c9a56a27aac9e9058ff592a021e2f4c3c94827fe70920d3cbb.js"></script>
<script defer src="/js/mobile.min.3a3510028bab9810834389725137cfa50f5d3231799ef9ac70769331fa59859a.js"></script>
<script defer src="/js/script.min.8e4d91ebe0d9226621e408b7205bd7b009e4935608e4b29c4275116490cc836d.js"></script>


</head>

<body>
<div class="page layout__page">
<header class="header layout__header">
<a href="/" title="Home" rel="home" class="header__logo"><img src="/images/logo.png" alt="Home" class="header__logo-image"></a>
<h1 class="header__site-name">
<a href="/" title="Home" class="header__site-link" rel="home"><span>Random thoughts</span></a>
</h1>
<div class="region header__region">

<form class="search-form" method="get" action="https://duckduckgo.com/" role="search">
<input type="search" name="q" class="search-text" placeholder="Search" title="Enter the terms you wish to search for." size="20" maxlength="128">
<input type="hidden" name="sites" value="harikt.com">
<input type="submit" value="DuckDuckGo Search" class="hidden">
</form>
</div>
</header>

<nav class="main-menu layout__navigation">
<h2 class="visually-hidden">Main menu</h2>
<ul class="navbar">
<li><a class="" href="/">Home</a></li>
<li><a class="" href="/about/">About</a></li>
<li><a class="" href="/blog/archives/">Archive</a></li>
<li><a class="" href="/contact/">Contact</a></li>
<li><a class="active" href="/blog/">Blog</a></li>
</ul>
</nav>


<main class="main layout__main">
<article class="section-blog single-view">
<header>
<h1 class="title title-submitted">magento and rest api</h1>
<p class="submitted">
<time class="modified-date" datetime="2013-07-05T00:00:00Z">5 July, 2013</time>
</p>
</header>
<div class="content">
<p>Magento provides both REST and SOAP api. In this post I would like to
concentrate on REST api to connect and get the products from magento shop.</p>
<p>First we want to register an Oauth consumer to get the consumer key and secret key.</p>
<p>Login to the admin of the magento shop and from the menu
<code>System-&gt;Web Services-&gt;REST - Oauth Consumers</code> and add a new Ouath consumer.</p>
<p><img src="http://harikt.com/images/oauth-consumer.png" alt="REST - Oauth Consumers"></p>
<p>You need the Key and Secret which is what we pass in the config to
<code>Zend_Oauth_Consumer</code> shortly.</p>
<p>Let us also assign the right permissions for the attributes. From the menu
<code>System-&gt;Web Services-&gt;REST - Attributes</code> click on Admin and assign the right
permission. In our case we give access to products.</p>
<p><img src="http://harikt.com/images/magento_rest_attributes.png" alt="REST - Attributes"></p>
<p>Now it is time to show you some code. In most case, we would have defined a
named route, and depeding upon your route in zend framework call the url.</p>
<p>Assuming the default url <code>http://localhost:8000/index/index</code> and accessing
this in your browser will redirect you to the magento shop and get the access token after
you authenticating and allowing it.</p>
<p>Note : Make sure that the domain you have logged in and the one
you have provided in the callback url of magento REST Oauth consumer are
same. Else you will find hard time debugging why session is lost.
(I am talking about the difference in <a href="http://www.example.com">http://www.example.com</a> and <a href="http://example.com">http://example.com</a>)</p>
<p>You want to change the below parameters in the controller according to yours.</p>
<p><code>$this-&gt;hostname</code>: The magento shop</p>
<p><code>$consumerKey</code>: The key you got when creating the oauth consumer</p>
<p><code>$consumerSecret</code>: The secret key you got when creating the oauth consumer</p>
<p><code>$callbackUrl</code>: The url where it will be redirected to get the accesstoken,
same as the one you have provided when creating the oauth consumer.</p>
<h2 id="source-code">Source Code</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexController</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Zend_Controller_Action</span>
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">init</span>()
    {
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hostname</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;the-magento-host&#39;</span>;
        $consumerKey <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
        $consumerSecret <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
        $callbackUrl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;callback-url&#39;</span>;
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
            <span style="color:#e6db74">&#39;callbackUrl&#39;</span> <span style="color:#f92672">=&gt;</span> $callbackUrl,
            <span style="color:#e6db74">&#39;requestTokenUrl&#39;</span> <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hostname</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/oauth/initiate&#39;</span>,
            <span style="color:#e6db74">&#39;siteUrl&#39;</span> <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hostname</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/oauth&#39;</span>,
            <span style="color:#e6db74">&#39;consumerKey&#39;</span> <span style="color:#f92672">=&gt;</span> $consumerKey,
            <span style="color:#e6db74">&#39;consumerSecret&#39;</span> <span style="color:#f92672">=&gt;</span> $consumerSecret,
            <span style="color:#e6db74">&#39;authorizeUrl&#39;</span> <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hostname</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/admin/oauth_authorize&#39;</span>,
            <span style="color:#75715e">// &#39;authorizeUrl&#39; =&gt; $this-&gt;hostname . &#39;/oauth/authorize&#39;,
</span><span style="color:#75715e"></span>            <span style="color:#e6db74">&#39;accessTokenUrl&#39;</span> <span style="color:#f92672">=&gt;</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hostname</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/oauth/token&#39;</span>
        );
    }

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">indexAction</span>()
    {        
        $accesssession <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Session_Namespace</span>(<span style="color:#e6db74">&#39;AccessToken&#39;</span>);
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($accesssession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">accessToken</span>)) {
            $token <span style="color:#f92672">=</span> <span style="color:#a6e22e">unserialize</span>($accesssession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">accessToken</span>);            
            <span style="color:#75715e">// $client = $token-&gt;getHttpClient($this-&gt;config);
</span><span style="color:#75715e"></span>            $client <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Http_Client</span>();
            $adapter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Http_Client_Adapter_Curl</span>();
            $client<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAdapter</span>($adapter);
            $adapter<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setConfig</span>(<span style="color:#66d9ef">array</span>(
                <span style="color:#e6db74">&#39;adapter&#39;</span>   <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Zend_Http_Client_Adapter_Curl&#39;</span>,
                <span style="color:#e6db74">&#39;curloptions&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#a6e22e">CURLOPT_FOLLOWLOCATION</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span>),
            ));
            $client<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setUri</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hostname</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;/api/rest/products&#39;</span>);
            $client<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setParameterGet</span>(<span style="color:#e6db74">&#39;oauth_token&#39;</span>, $token<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getToken</span>());
            $client<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setParameterGet</span>(<span style="color:#e6db74">&#39;oauth_token_secret&#39;</span>, $token<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getTokenSecret</span>());
            $response <span style="color:#f92672">=</span> $client<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">request</span>(<span style="color:#e6db74">&#39;GET&#39;</span>);
            $products <span style="color:#f92672">=</span> <span style="color:#a6e22e">Zend_Json</span><span style="color:#f92672">::</span><span style="color:#a6e22e">decode</span>($response<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getBody</span>());
        } <span style="color:#66d9ef">else</span> {
            $consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Oauth_Consumer</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">config</span>);
            $token <span style="color:#f92672">=</span> $consumer<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getRequestToken</span>();
            $requestsession <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Session_Namespace</span>(<span style="color:#e6db74">&#39;RequestToken&#39;</span>);
            $requestsession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">requestToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">serialize</span>($token);
            $consumer<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">redirect</span>();
        }
        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">view</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">products</span> <span style="color:#f92672">=</span> $products;
    }
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">callbackAction</span>()
    {
        $requestsession <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Session_Namespace</span>(<span style="color:#e6db74">&#39;RequestToken&#39;</span>);
        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#66d9ef">empty</span>($_GET) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">isset</span>($requestsession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">requestToken</span>)) {
            $accesssession <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Session_Namespace</span>(<span style="color:#e6db74">&#39;AccessToken&#39;</span>);
            $consumer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Zend_Oauth_Consumer</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">config</span>);
            $token <span style="color:#f92672">=</span> $consumer<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getAccessToken</span>(
                $_GET,
                <span style="color:#a6e22e">unserialize</span>($requestsession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">requestToken</span>)
            );
            $accesssession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">accessToken</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">serialize</span>($token);
            <span style="color:#75715e">// Now that we have an Access Token, we can discard the Request Token
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">unset</span>($requestsession<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">requestToken</span>);
            <span style="color:#75715e">// $this-&gt;_redirect();
</span><span style="color:#75715e"></span>            $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">_forward</span>(<span style="color:#e6db74">&#39;index&#39;</span>, <span style="color:#e6db74">&#39;index&#39;</span>, <span style="color:#e6db74">&#39;default&#39;</span>);
        } <span style="color:#66d9ef">else</span> {
            <span style="color:#75715e">// Mistaken request? Some malfeasant trying something?
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#39;Invalid callback request. Oops. Sorry.&#39;</span>);
        }
    }
    
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">callbackrejectedAction</span>()
    {
        <span style="color:#75715e">// rejected
</span><span style="color:#75715e"></span>    }
}
</code></pre></div><p>Normally you can get the http client by <code>$token-&gt;getHttpClient($this-&gt;config)</code>
rather than creating <code>Zend_Http_Client</code> as I did. But due to some issues
the request was getting <code>Service Temporarily Unavailable</code> as response.</p>
<p>The <code>Service Temporarily Unavailable</code> can also be due to permission issues.
You should also check whether you have given the right permissions for
roles and resources.</p>
<p>In most case, we would have defined a named route, so you could use the
url helpers to generate the route. I hope this helps you to move with REST
and Magento</p>
<h2 id="resources">Resources</h2>
<p><a href="http://www.magentocommerce.com/api/rest/introduction.html">Magento REST API</a></p>
<p><a href="http://framework.zend.com/manual/1.12/en/zend.oauth.introduction.html">zend oauth introduction</a></p>
<h2 id="thanks">Thanks</h2>
<p>I would like to thank <a href="http://phpcloud.com">PHP Cloud</a> for providing the
free service to deploy the magento shop and test it. Installing and deploying app was super
simple. So if you have not tried it is time for it.</p>


</div>
</article>
</main>


<footer class="footer layout__footer">
<p><!-- raw HTML omitted --></p>
<p>Powered by <a href="https://gohugo.io/">Hugo</a> and the <a href="https://github.com/frjo/hugo-theme-zen">Zen theme</a>.</p>

</footer>

</div>
<div class="mobile-nav" dir="ltr">
  <div class="mobile-nav__cover"></div>
  <a href="#navigation" class="mobile-nav__toggle" aria-haspopup="true" role="button">Menu</a>
  <div class="mobile-nav__sheet">
    <div class="mobile-nav__region">
    
    
<form class="search-form" method="get" action="https://duckduckgo.com/" role="search">
<input type="search" name="q" class="search-text" placeholder="Search" title="Enter the terms you wish to search for." size="20" maxlength="128">
<input type="hidden" name="sites" value="harikt.com">
<input type="submit" value="DuckDuckGo Search" class="hidden">
</form>

    </div>
    <nav class="mobile-nav__main-menu">
    <h2 class="visually-hidden">Main menu</h2>
    <ul class="mobile-nav__navbar">
    <li><a class="" href="/">Home</a></li>
    <li><a class="" href="/about/">About</a></li>
    <li><a class="" href="/blog/archives/">Archive</a></li>
    <li><a class="" href="/contact/">Contact</a></li>
    <li><a class="active" href="/blog/">Blog</a></li>
    </ul>
    </nav>
  </div>
</div>
</body>
</html>
